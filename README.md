# Документация к проекту ScoreWorker

## Краткое описание проекта

Проект создан для соединения системы HR и возможностей AI для оценки компетенций человека на основе отзывов его коллег.
Система выводит информацию на основе оценки 360. Выдает общую сводку по человеку, оценку и описание определенных критериев, собственное мнение человека,
его отрицательные и положительные качества. Дополнительно была добавлена возможность посмотреть мнение человека о своем коллеге на основе его отзывов.

## Текущее состояние проекта

На данный момент проект на стадии MVP. Добавлена база данных, есть минимальные prompt для взаимодействия с ИИ, также есть интерфейс расположенный в другом репозитории. 
https://github.com/1rd0/FrontVKSCOREWorker

## Используемый стэк
   - ASP.NET - платформа разработки веб-приложений на основе C#
   - Handfire - используется для создания отложенных/регулярных задач
   - Entity Framework Core - ORM 
   - Refit - обеспечивает обращение к API сторонних сервисов
   - AutoMapper - автоматическый маппинг на основе заданных правил
   - Serilog - библиотека для полноценного логгирования

## Описание составляющих

Решение состоит из 8 проектов. Рассмотрим их подробнее
1. ScoreWorker - веб сервис. Основные его компоненты - это два контроллера и инфраструктура. Контроллера Test служит исключительно для тестирования и не влияет на основные данные. Контроллера ScoreWorker содержит три endpoind-а
   - api/get/summary - Пользователю выдается сводка о работнике из базы данных, используется для фронта
   - api/get/opinion - На основе двух id возвращается общее мнение первого человека о втором
   - api/generate - Данный endpoind генерирует сводку по человеку и записывает его в базу данных. Далее создается регулярная задача, благодаря которой, данные систематически обновляются
2. ScoreWorker.DB содержит файлы для взаимодействия с базой данных
3. ScoreWorker.Domain отвечает за бизнес логику и состоит из двух сервисов и их интерфейсов. Сервис теста на данный момент содержит один метод - подгрузку данных из предоставленного json файла в базу данных. ScoreWorkerService реализует методы генерации сводки, добавления и получения ее из БД. Также в нем есть методы для генерации отдельных частей, таких как self-review. Методы являются публичными, чтобы обращаться к ним через тестовый контроллер.
4. ScoreWorker.Models состоит из используемых моделей DTO и Enum.
5. ScoreWorker.Models.Db также содержит модели, но для базы данных. В них присутствует настройка отношений между сущностями и навигационные свойства. Всего содержится 4 модели данных
   - DbSummary отражает данные сводки и соединяется с остальными сущностями отношением "одни ко многим"
   - DbReview нужен для сохранения отзывов
   - DbScoreCriteria хранит данные по критериям оценки. Было принято решение вынести в отдельную таблицу ради удобства расширения и сохранение нормальных форм.
   - DbCountingReviews нужен для хранения отзывов тех или иных видов
6. ScoreWorker.Models.Exceptions используется для создания исключений со статус кодами, BadRequestException нужно для возврата ошибки при неправильных данных. Остальные модели нужны для реализации расширяемости.
7. ScoreWorker.PromptHelpers отвечает за взаимодействия с AI.
   - PromptHandler возвращает  сводку, сформированную нейронной сетью, добавляет в текст файлов prompt-ов все подходящие под условия ревью и в нем же определяются настройки LLM
   - PromptParser переводит сводку, полученную из PromptHandler в необходимую нам модель. Для парсинга используются регулярные выражения. В prompt специально заданы определенные способы возврата для наиболее удобного парсинга.
   - PromptPathContainer хранит названия файлов и на основе Enum определяет какой из файлов нам нужен
8. ScoreWorker.RefitApi состоит из единственного файла IVkControllerApi. Он нужен для обращения к API генерации и содержит метод представляющий endpoint.

